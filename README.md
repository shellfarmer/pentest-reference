# pentest-reference

A collection of information about penetration testing, initally to aid my study for CPSA/CRPT

This is a work in progress document so content may be incorrect or change! 


  * [Passive Reconnaissance](#passive-reconnaissance)
    + [Whois](#whois)
    + [DNS](#dns)
      - [Status](#status)
      - [Records types](#records-types)
      - [Commands](#commands)
  * [Active Reconnaissance](#active-reconnaissance)
    + [Path and route mapping](#path-and-route-mapping)
    + [Target identification](#target-identification)
  * [Scanning and Enumeration](#scanning-and-enumeration)
  * [Exploiting](#exploiting)

## Passive Reconnaissance and OSINT

#### Google 

Google hacking database - https://www.exploit-db.com/google-hacking-database/  
Google advanced search - https://www.google.com/advanced_search  

Search directives: 

intext:password filetype:xlsx - Displays results with text in page/file  
intitle:"index of /backup" - Displays results with text in title  
inurl:dyn_sensors.htm - Dsiplays results with the text in the url  
filetype:log intext:password - Returns any log files with password in them  
site:edu filetype:key intext:private - Returns files with private keys for edu domains  
"nist.gov" mail tel fax - Returns contact detals for domain  
site:mit.edu - enumerate web servers  
allintitle: "index of data" site:nasa.gov - Returns directory lists of data  
filetype:pcf grouppwd - Cisco VPN file
filetype:opvn - OpenVPN file
filetype: id_rsa - SSH key



#### Shodan
Shodan service search - https://www.shodan.io/  

Search filters: 

city: "london"  
country:DE  
geo:32.8 -117,50  
hostname:sslvpn  
net:21219.0.0/16  
os:linux  
port:5060  
before:18/1/2010  
after: 23/3/2010  

#### Others

Internet wide scan data repository - https://scans.io/  
Censys Internet scanning - https://censys.io/  
Netcraft website search - https://searchdns.netcraft.com/?  
Search PGP keys - https://keyserver.ubuntu.com/, http://pgp.mit.edu/, http://pgp.uni-mainz.de/


### Whois
Whois is a query and response protocol that is widely used for querying databases that store the registered users or assignees of an Internet resource

Registry TLD listings - https://www.icann.org/resources/pages/listing-2012-02-25-en, http://www.iana.org/domains/root/db  

GBP AS listing - https://bgp.he.net/  

| Name    | Region                      | Website                  |
|---------|-----------------------------|--------------------------|
| ARIN    | North American              | https://www.arin.net/    |
| RIPE    | Europe                      | https://www.ripe.net/    |
| APNIC   | Asia Pacific                | https://www.apnic.net/   |
| LACNIC  | Latin America and Caribbean | https://www.lacnic.net/  |
| AFRINIC | Africa                      | https://www.afrinic.net/ |


`whois <domain>`

Response:

```
Domain Name: google.com
Registry Domain ID: 2138514_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.markmonitor.com
Registrar URL: http://www.markmonitor.com
Updated Date: 2018-02-21T10:45:07-0800
Creation Date: 1997-09-15T00:00:00-0700
Registrar Registration Expiration Date: 2020-09-13T21:00:00-0700
Registrar: MarkMonitor, Inc.
Registrar IANA ID: 292
Registrar Abuse Contact Email: abusecomplaints@markmonitor.com
Registrar Abuse Contact Phone: +1.2083895740
Domain Status: clientUpdateProhibited (https://www.icann.org/epp#clientUpdateProhibited)
Domain Status: clientTransferProhibited (https://www.icann.org/epp#clientTransferProhibited)
Domain Status: clientDeleteProhibited (https://www.icann.org/epp#clientDeleteProhibited)
Domain Status: serverUpdateProhibited (https://www.icann.org/epp#serverUpdateProhibited)
Domain Status: serverTransferProhibited (https://www.icann.org/epp#serverTransferProhibited)
Domain Status: serverDeleteProhibited (https://www.icann.org/epp#serverDeleteProhibited)
Registry Registrant ID: 
Registrant Name: Domain Administrator
Registrant Organization: Google LLC
Registrant Street: 1600 Amphitheatre Parkway, 
Registrant City: Mountain View
Registrant State/Province: CA
Registrant Postal Code: 94043
Registrant Country: US
Registrant Phone: +1.6502530000
Registrant Phone Ext: 
Registrant Fax: +1.6502530001
Registrant Fax Ext: 
Registrant Email: dns-admin@google.com
Registry Admin ID: 
Admin Name: Domain Administrator
Admin Organization: Google LLC
Admin Street: 1600 Amphitheatre Parkway, 
Admin City: Mountain View
Admin State/Province: CA
Admin Postal Code: 94043
Admin Country: US
Admin Phone: +1.6502530000
Admin Phone Ext: 
Admin Fax: +1.6502530001
Admin Fax Ext: 
Admin Email: dns-admin@google.com
Registry Tech ID: 
Tech Name: Domain Administrator
Tech Organization: Google LLC
Tech Street: 1600 Amphitheatre Parkway, 
Tech City: Mountain View
Tech State/Province: CA
Tech Postal Code: 94043
Tech Country: US
Tech Phone: +1.6502530000
Tech Phone Ext: 
Tech Fax: +1.6502530001
Tech Fax Ext: 
Tech Email: dns-admin@google.com
Name Server: ns3.google.com
Name Server: ns2.google.com
Name Server: ns4.google.com
Name Server: ns1.google.com
DNSSEC: unsigned
URL of the ICANN WHOIS Data Problem Reporting System: http://wdprs.internic.net/
>>> Last update of WHOIS database: 2018-04-26T00:36:22-0700 <<<
```
`whois <ip>`
 
 ```
 NetRange:       216.58.192.0 - 216.58.223.255
CIDR:           216.58.192.0/19
NetName:        GOOGLE
NetHandle:      NET-216-58-192-0-1
Parent:         NET216 (NET-216-0-0-0-0)
NetType:        Direct Allocation
OriginAS:       AS15169
Organization:   Google LLC (GOGL)
RegDate:        2012-01-27
Updated:        2012-01-27
Ref:            https://whois.arin.net/rest/net/NET-216-58-192-0-1



OrgName:        Google LLC
OrgId:          GOGL
Address:        1600 Amphitheatre Parkway
City:           Mountain View
StateProv:      CA
PostalCode:     94043
Country:        US
RegDate:        2000-03-30
Updated:        2017-12-21
Ref:            https://whois.arin.net/rest/org/GOGL


OrgAbuseHandle: ABUSE5250-ARIN
OrgAbuseName:   Abuse
OrgAbusePhone:  +1-650-253-0000 
OrgAbuseEmail:  network-abuse@google.com
OrgAbuseRef:    https://whois.arin.net/rest/poc/ABUSE5250-ARIN

OrgTechHandle: ZG39-ARIN
OrgTechName:   Google LLC
OrgTechPhone:  +1-650-253-0000 
OrgTechEmail:  arin-contact@google.com
OrgTechRef:    https://whois.arin.net/rest/poc/ZG39-ARIN

 ```
 
### BGP 

https://bgp.he.net/<as-number>

### DNS 

#### Status
* NOERROR - The zone is being served from the requested authority without issues.
* SERVFAIL - The name that was queried exists, but there's no data or invaid data for that name at the requested authority. 
* NXDOMAIN - The name in question does not exist, and therefore there is no authoritative DNS data to be served.
* REFUSED - Not only does the zone not exist at the requested authority, but their infrastructure is not in the business of 
serving things that don't exist at all.

#### Records types

* SAO - Start of Authority - Information about the zone
  * ns1.google.com. dns-admin.google.com. 193589216 900 900 1800 60
    *  The primary name server for the domain
    *  The responsible party for the domain
    *  A timestamp that changes whenever you update your domain
    *  The number of seconds before the zone should be refreshed
    *  The number of seconds before a failed refresh should be retried
    *  The upper limit in seconds before a zone is considered no longer authoritative
    *  The negative result TTL (how long a resolver should consider a negative result for a subdomain to be valid before retrying)
* MX - Mail exchange -  For locating mail servers
  * google.com.		600	IN	MX	10 aspmx.l.google.com
* TXT - Text record - Human readable used a lot for security related things like SPF/DKIM
  * google.com.		300	IN	TXT	"v=spf1 include:_spf.google.com ~all"
* A (AAAA)- Address record, returns IP
  * google.com.		148	IN	A	216.58.212.110
* NS - Name Server - Returns name servers for domain
  * google.com.		98140	IN	NS	ns2.google.com.
* PTR -  Pointer record, used for reverse DNS. Unlike a CNAME, DNS processing stops and just the name is returned.
   * due to reversed order of address address need to use:
      * `dig -x <ip>`
  * 68.16.217.172.in-addr.arpa. 55760 IN	PTR	par03s13-in-f68.1e100.net.
* HINFO - Provides information about host (CPU/OS)
  *   IN      HINFO   PC-Intel-700mhz "Redhat Linux 7.1"
* CNAME -  Canoncical Name - alias to another name
   * www.cisco.com.		2605	IN	CNAME	www.cisco.com.akadns.net.
* AXFR - Zone transfer
   * Returns all records in zone
* SRV - Service locator,  application service endpoints (Kerberos, LDAP, SIP etc)  

#### DNS lookup Commands

`dig <type> @<dns-server> <host> <+short>`

`host -t <type> <host> <server>`
 
``` 
nslookup  
  <server>  
  set q=<type>  
  <host>
```
#### DNS domain/host enumeration

Brute force subdomains and hostnames. 
Get seclists and use dictionaries in /usr/share/seclists/Discovery/DNS

`dnsmap -w <wordlist-file> <domain>`  

`dnsrecon -t brt -D <dictionary> -d <domain>`  

fastest:  
`gobuster -m dns -i -w <wordlist> -u <domain>`  

Reverse lookup 
`dnsrecon -t rvl -r <ip-range>` 

DNSSEC (NSEC and SEC3) 
` ldns-walk <domain>`

srv records: 
`nmap --script dns-srv-enum --script-args dns-srv-enum.domain=<domain>`  


https://www.robtex.com/dns-lookup/<domain>  
https://www.robtex.com/ip-lookup/<ip>  
 
## Active Reconnaissance

### path and route mapping

Linux uses UDP packets by default

`traceroute <host>`

-T tcp trace  
-I ICMP trace 

Windows uses ICMP

`tracert <host>`

```
Tracing route to www.google.com [172.217.16.68]
over a maximum of 30 hops:

 1 <hops> ...
 21    23 ms    23 ms    23 ms  par03s13-in-f68.1e100.net [172.217.16.68]
```
### Target identification

nmap ping sweep 
`nmap -sP <targets>`

### SMTP probing

### Local network discovery 

#### Sniff network traffic  
Wirehshark  
TCP Dump  
netdiscover 

#### ARP poisioning 

cain & abel  
Ettercap  

sslstrip - downgrade HTTPS sessions  
responder - responds to name resolution requests
easy-creds - not in kali,  extracts creds
evilgrade - service impersonation http/dns
metasploit - service impersonation 

#### CAM table overflow
Overflow switches CAM table so it failed open and broadcasts all packets 
macof -i <interface>  

#### 802.1 Q attacks

##### Dynamic Trunking (VLAN hopping)

Abusing DTP  

Detecting:  
https://github.com/commonexploits/dtpscan 

```./dtpscan.sh 

########################################################
***   DTPScan - The VLAN DTP SCanner 1.3  ***

***   Detects DTP modes for VLAN Hopping (Passive) ***
########################################################

[-] The following Interfaces are available

eth0:
ether

----------------------------------------------------------
[?] Enter the interface to scan from as the source
---------------
```

| Mode              | Description                                                                                 |
|-------------------|---------------------------------------------------------------------------------------------|
| Access            | Permanent non trunking mode                                                                 |
| Trunk             | Permanent trunking mode                                                                     |
| Dynamic Auto      | May convert to trunk if other end is trunk or dynamic desirable, default setting            |
| Dynamic Desirable | Attempts to convert link to trunk if other end is trunk, dynamic desirable or dynamic auto  |
| Nonegotiate       | Disable dynamic trunking entirely                                                           |

Attack using yersina 

#### Configuring a VLAN


## Scanning and Enumeration 



## Exploiting
